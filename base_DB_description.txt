-- Lab "slow control" logging system sqlite3 database setup
-- sqlite3 <db name> < base_DB_description.txt

-- generic configuration key:value pairs
CREATE TABLE config_kv (
    k TEXT,     -- name of parameter
    v BLOB      -- parameter value
);
CREATE UNIQUE INDEX idx_config_kv ON config_kv(k);

-- useful keys:
--
-- creation_time unix timestamp for initialization of DB
-- prev_name     filename of previous archived dataset
-- prev_hash     file hash of previous archived dataset

-- instrument types: identifiers for data-taking instruments
CREATE TABLE instrument_types (
    name TEXT PRIMARY KEY,      -- identifying (short) name
    descrip TEXT,               -- longer description
    dev_name TEXT,              -- manufacturer device name
    serial TEXT                 -- identifying serial number
);

-- readout types
CREATE TABLE readout_types (
    name TEXT,                  -- readout name
    descrip TEXT,               -- longer description
    units TEXT,                 -- units
    instrument_id INTEGER       -- instrument type rowid from instrument_types
);
CREATE UNIQUE INDEX idx_readout_types ON readout_types(name, instrument_id);

-- a readout datapoint
CREATE TABLE readings (
    type_id INTEGER,    -- reading type, from readout_types rowid
    time REAL,          -- reading timestamp
    value REAL          -- reading value
);
CREATE INDEX idx_readings ON readings(type_id, time);

-- text log messages
CREATE TABLE textlog (
    time REAL,          -- message timestamp
    msg TEXT            -- message text
);
CREATE INDEX idx_textlog ON textlog(time);
